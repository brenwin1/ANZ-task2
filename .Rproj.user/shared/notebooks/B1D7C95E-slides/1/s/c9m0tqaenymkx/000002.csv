"0","# --- read in raw data"
"0","data <- readxl::read_xlsx(""data/ANZ synthesised transaction dataset.xlsx"")"
"2","Warning in read_fun(path = enc2native(normalizePath(path)), sheet_i = sheet,  :"
"2","
 "
"2"," Expecting numeric in C3052 / R3052C3: got 'THE DISCOUNT CHEMIST GROUP'
"
"2","Warning in read_fun(path = enc2native(normalizePath(path)), sheet_i = sheet,  :"
"2","
 "
"2"," Expecting numeric in C4360 / R4360C3: got 'LAND WATER & PLANNING East Melbourne'
"
"0","# --- data used"
"0","data_explore <- data"
"0",""
"0","# --- compute annual salary "
"0","annual_sal <- data_explore %>% "
"0","  filter(txn_description == ""PAY/SALARY"") %>% "
"0","  group_by(account) %>% "
"0","  summarise(annual_sal = (sum(amount)/3) * 12)"
"0",""
"0","# --- join annual salary data set to data_explore"
"0","data_explore <- left_join(data_explore, annual_sal,"
"0","                          by = ""account"")"
"0",""
"0","# --- filtering out purchase transactions"
"0","data_purchase <- data_explore %>% "
"0","  filter(txn_description %in% c(""POS"", ""SALES-POS""))"
"0","  # filter(merchant_id != """") # purchase transactions; must be associated with merchant "
"0",""
"0","# --- remove attributes (variables); unrelated to annual salary "
"0","data_explore2 <- data_explore %>% "
"0","  select(-status, -card_present_flag, -bpay_biller_code, # binary values"
"0","         -currency, # all AUD"
"0","         -merchant_id, -merchant_code, -merchant_long_lat, # nothing to do with merchants"
"0","         -first_name, # character type"
"0","         -merchant_suburb, -merchant_state, # nothing to do with merchants"
"0","         -extraction, # date & time irrelevant"
"0","         -transaction_id, # irrelevant"
"0","         -customer_id, # irrelevant"
"0","         -country) # all in AUS"
"0",""
"0","# --- separate `long_lat` into 2 columns `lon` & `lat`"
"0","data_explore2 <- data_explore2 %>% "
"0","  tidyr::separate(col = long_lat,"
"0","                  sep = "" -"","
"0","                  into = c(""lon"", ""lat"")) %>% "
"0","  # turn `lon` & `lat`; into numeric "
"0","  mutate(lon = as.numeric(lon),"
"0","         lat = as.numeric(lat))"
"0",""
"0","data_purchase <- data_purchase %>% "
"0","  group_by(account) %>% "
"0","  mutate(total_spend = sum(amount), # total spending: total purchase transactions amount"
"0","         total_spend_vol = n()) %>% # total spending volume: number of purchase transactions"
"0","  distinct(account,"
"0","           .keep_all = T)"
"0",""
"0","# --- join data with purchase data "
"0","model_data <- data_purchase %>% "
"0","  select(account, total_spend, total_spend_vol) %>% "
"0","  right_join(data_explore2) %>% "
"0","  ungroup() %>% "
"0","  select(-txn_description, -date, -movement, -amount, -account)"
"1","Joining, by = ""account""
"
